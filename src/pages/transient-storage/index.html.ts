// metadata
export const version = "0.8.24"
export const title = "Transient Storage"
export const description = "transient storage"

export const keywords = [
    "transient",
    "storage",
]

export const codes = [
    {
        fileName: "TransientStorage.sol",
        code: "cHJhZ21hIHNvbGlkaXR5IF4wLjguMjQ7CgovLyBNYWtlIHN1cmUgRVZNIHZlcnNpb24gYW5kIFZNIHNldCB0byBDYW5jdW4KCi8vIFN0b3JhZ2UgLSBkYXRhIGlzIHN0b3JlZCBvbiB0aGUgYmxvY2tjaGFpbgovLyBNZW1vcnkgLSBkYXRhIGlzIGNsZWFyZWQgb3V0IGFmdGVyIGEgZnVuY3Rpb24gY2FsbAovLyBUcmFuc2llbnQgc3RvcmFnZSAtIGRhdGEgaXMgY2xlYXJlZCBvdXQgYWZ0ZXIgYSB0cmFuc2FjdGlvbgoKaW50ZXJmYWNlIElUZXN0IHsKICAgIGZ1bmN0aW9uIHZhbCgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiB0ZXN0KCkgZXh0ZXJuYWw7Cn0KCmNvbnRyYWN0IENhbGxiYWNrIHsKICAgIHVpbnQyNTYgcHVibGljIHZhbDsKCiAgICBmYWxsYmFjaygpIGV4dGVybmFsIHsKICAgICAgICB2YWwgPSBJVGVzdChtc2cuc2VuZGVyKS52YWwoKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0ZXN0KGFkZHJlc3MgdGFyZ2V0KSBleHRlcm5hbCB7CiAgICAgICAgSVRlc3QodGFyZ2V0KS50ZXN0KCk7CiAgICB9Cn0KCmNvbnRyYWN0IFRlc3RTdG9yYWdlIHsKICAgIHVpbnQyNTYgcHVibGljIHZhbDsKCiAgICBmdW5jdGlvbiB0ZXN0KCkgcHVibGljIHsKICAgICAgICB2YWwgPSAxMjM7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSAiIjsKICAgICAgICBtc2cuc2VuZGVyLmNhbGwoYik7CiAgICB9Cn0KCmNvbnRyYWN0IFRlc3RUcmFuc2llbnRTdG9yYWdlIHsKICAgIGJ5dGVzMzIgY29uc3RhbnQgU0xPVCA9IDA7CgogICAgZnVuY3Rpb24gdGVzdCgpIHB1YmxpYyB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICB0c3RvcmUoU0xPVCwgMzIxKQogICAgICAgIH0KICAgICAgICBieXRlcyBtZW1vcnkgYiA9ICIiOwogICAgICAgIG1zZy5zZW5kZXIuY2FsbChiKTsKICAgIH0KCiAgICBmdW5jdGlvbiB2YWwoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHYpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHYgOj0gdGxvYWQoU0xPVCkKICAgICAgICB9CiAgICB9Cn0KCmNvbnRyYWN0IFJlZW50cmFuY3lHdWFyZCB7CiAgICBib29sIHByaXZhdGUgbG9ja2VkOwoKICAgIG1vZGlmaWVyIGxvY2soKSB7CiAgICAgICAgcmVxdWlyZSghbG9ja2VkKTsKICAgICAgICBsb2NrZWQgPSB0cnVlOwogICAgICAgIF87CiAgICAgICAgbG9ja2VkID0gZmFsc2U7CiAgICB9CgogICAgLy8gMzUzMTMgZ2FzCiAgICBmdW5jdGlvbiB0ZXN0KCkgcHVibGljIGxvY2sgewogICAgICAgIC8vIElnbm9yZSBjYWxsIGVycm9yCiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSAiIjsKICAgICAgICBtc2cuc2VuZGVyLmNhbGwoYik7CiAgICB9Cn0KCmNvbnRyYWN0IFJlZW50cmFuY3lHdWFyZFRyYW5zaWVudCB7CiAgICBieXRlczMyIGNvbnN0YW50IFNMT1QgPSAwOwoKICAgIG1vZGlmaWVyIGxvY2soKSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBpZiB0bG9hZChTTE9UKSB7IHJldmVydCgwLCAwKSB9CiAgICAgICAgICAgIHRzdG9yZShTTE9ULCAxKQogICAgICAgIH0KICAgICAgICBfOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgdHN0b3JlKFNMT1QsIDApCiAgICAgICAgfQogICAgfQoKICAgIC8vIDIxODg3IGdhcwogICAgZnVuY3Rpb24gdGVzdCgpIGV4dGVybmFsIGxvY2sgewogICAgICAgIC8vIElnbm9yZSBjYWxsIGVycm9yCiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSAiIjsKICAgICAgICBtc2cuc2VuZGVyLmNhbGwoYik7CiAgICB9Cn0K",
    },
]

const html = `<p>Data stored in transient storage is cleared out after transaction.</p>
<pre><code class="language-solidity"><span class="hljs-meta"><span class="hljs-keyword">pragma</span> <span class="hljs-keyword">solidity</span> ^0.8.24;</span>

<span class="hljs-comment">// Make sure EVM version and VM set to Cancun</span>

<span class="hljs-comment">// Storage - data is stored on the blockchain</span>
<span class="hljs-comment">// Memory - data is cleared out after a function call</span>
<span class="hljs-comment">// Transient storage - data is cleared out after a transaction</span>

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ITest</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">val</span>(<span class="hljs-params"></span>) <span class="hljs-title"><span class="hljs-keyword">external</span></span> <span class="hljs-title"><span class="hljs-keyword">view</span></span> <span class="hljs-title"><span class="hljs-keyword">returns</span></span> (<span class="hljs-params"><span class="hljs-keyword">uint256</span></span>)</span>;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>) <span class="hljs-title"><span class="hljs-keyword">external</span></span></span>;
}

<span class="hljs-class"><span class="hljs-keyword">contract</span> <span class="hljs-title">Callback</span> </span>{
    <span class="hljs-keyword">uint256</span> <span class="hljs-keyword">public</span> val;

    <span class="hljs-function"><span class="hljs-keyword">fallback</span>(<span class="hljs-params"></span>) <span class="hljs-title"><span class="hljs-keyword">external</span></span> </span>{
        val <span class="hljs-operator">=</span> ITest(<span class="hljs-built_in">msg</span>.<span class="hljs-built_in">sender</span>).val();
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"><span class="hljs-keyword">address</span> target</span>) <span class="hljs-title"><span class="hljs-keyword">external</span></span> </span>{
        ITest(target).test();
    }
}

<span class="hljs-class"><span class="hljs-keyword">contract</span> <span class="hljs-title">TestStorage</span> </span>{
    <span class="hljs-keyword">uint256</span> <span class="hljs-keyword">public</span> val;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>) <span class="hljs-title"><span class="hljs-keyword">public</span></span> </span>{
        val <span class="hljs-operator">=</span> <span class="hljs-number">123</span>;
        <span class="hljs-keyword">bytes</span> <span class="hljs-keyword">memory</span> b <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
        <span class="hljs-built_in">msg</span>.<span class="hljs-built_in">sender</span>.<span class="hljs-built_in">call</span>(b);
    }
}

<span class="hljs-class"><span class="hljs-keyword">contract</span> <span class="hljs-title">TestTransientStorage</span> </span>{
    <span class="hljs-keyword">bytes32</span> <span class="hljs-keyword">constant</span> SLOT <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>) <span class="hljs-title"><span class="hljs-keyword">public</span></span> </span>{
        <span class="hljs-keyword">assembly</span> {
            tstore(SLOT, <span class="hljs-number">321</span>)
        }
        <span class="hljs-keyword">bytes</span> <span class="hljs-keyword">memory</span> b <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
        <span class="hljs-built_in">msg</span>.<span class="hljs-built_in">sender</span>.<span class="hljs-built_in">call</span>(b);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">val</span>(<span class="hljs-params"></span>) <span class="hljs-title"><span class="hljs-keyword">public</span></span> <span class="hljs-title"><span class="hljs-keyword">view</span></span> <span class="hljs-title"><span class="hljs-keyword">returns</span></span> (<span class="hljs-params"><span class="hljs-keyword">uint256</span> v</span>) </span>{
        <span class="hljs-keyword">assembly</span> {
            v <span class="hljs-operator">:=</span> tload(SLOT)
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">contract</span> <span class="hljs-title">ReentrancyGuard</span> </span>{
    <span class="hljs-keyword">bool</span> <span class="hljs-keyword">private</span> locked;

    <span class="hljs-function"><span class="hljs-keyword">modifier</span> <span class="hljs-title">lock</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">require</span>(<span class="hljs-operator">!</span>locked);
        locked <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">_</span>;
        locked <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">// 35313 gas</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>) <span class="hljs-title"><span class="hljs-keyword">public</span></span> <span class="hljs-title">lock</span> </span>{
        <span class="hljs-comment">// Ignore call error</span>
        <span class="hljs-keyword">bytes</span> <span class="hljs-keyword">memory</span> b <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
        <span class="hljs-built_in">msg</span>.<span class="hljs-built_in">sender</span>.<span class="hljs-built_in">call</span>(b);
    }
}

<span class="hljs-class"><span class="hljs-keyword">contract</span> <span class="hljs-title">ReentrancyGuardTransient</span> </span>{
    <span class="hljs-keyword">bytes32</span> <span class="hljs-keyword">constant</span> SLOT <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-function"><span class="hljs-keyword">modifier</span> <span class="hljs-title">lock</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">assembly</span> {
            <span class="hljs-keyword">if</span> tload(SLOT) { <span class="hljs-keyword">revert</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>) }
            tstore(SLOT, <span class="hljs-number">1</span>)
        }
        <span class="hljs-keyword">_</span>;
        <span class="hljs-keyword">assembly</span> {
            tstore(SLOT, <span class="hljs-number">0</span>)
        }
    }

    <span class="hljs-comment">// 21887 gas</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>) <span class="hljs-title"><span class="hljs-keyword">external</span></span> <span class="hljs-title">lock</span> </span>{
        <span class="hljs-comment">// Ignore call error</span>
        <span class="hljs-keyword">bytes</span> <span class="hljs-keyword">memory</span> b <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
        <span class="hljs-built_in">msg</span>.<span class="hljs-built_in">sender</span>.<span class="hljs-built_in">call</span>(b);
    }
}
</code></pre>`

export default html
